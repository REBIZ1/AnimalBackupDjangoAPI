<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Собаки API</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
            max-width: 900px;
            margin: auto;
        }
        .card {
            padding: 20px;
            background: #f5f5f5;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        select, input[type="text"] {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #888;
            font-size: 15px;
            margin-top: 5px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
        }
        .btn-primary {
            background: #4a8ef5;
            color: white;
        }
        .btn-primary:hover {
            background: #3a74ce;
        }
        .btn-green {
            background: #37a759;
            color: white;
        }
        .btn-green:hover {
            background: #2d8748;
        }
        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
        }
        img {
            width: 100%;
            border-radius: 10px;
        }
        h3 {
            margin-bottom: 15px;
        }
        .sub-title {
            color: #444;
            font-size: 15px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<h2>Собаки API</h2>

<div class="card">
    <form action="{% url 'get_dog_image' %}" method="POST">
        {% csrf_token %}

        <label>Выберите породу:</label>
        <select name="breed" id="breedSelect" onchange="updatePath()">
            <option value="">-- выберите породу --</option>

            {% for breed in breeds %}
                <option value="{{ breed }}"
                    {% if breed == selected_breed %}selected{% endif %}>
                    {{ breed }}
                </option>
            {% endfor %}
        </select>

        <br><br>

        <label>Путь на Яндекс.Диске:</label>
        <input type="text" id="pathField" name="path" readonly
               value="{{ path_value|default:'' }}">

        <br><br>

        <button type="submit" class="btn-primary">Получить картинку</button>
    </form>
</div>

<div class="card">
    <form action="{% url 'upload_dog_to_disk' %}" method="POST">
        {% csrf_token %}
        <button type="submit" class="btn-green" {% if not image_b64 %}disabled{% endif %}>
            Загрузить на Яндекс.Диск
        </button>
    </form>
</div>

{% if image_b64 %}
<div class="card">
    <h3>Основная порода:</h3>
    <img src="data:image/jpeg;base64,{{ image_b64 }}">
</div>
{% endif %}

{% if sub_images %}
<div class="card">
    <h3>Подпороды:</h3>
    <div class="images-grid">
        {% for subbreed, sub_b64 in sub_images.items %}
        <div>
            <div class="sub-title">{{ subbreed }}</div>
            <img src="data:image/jpeg;base64,{{ sub_b64 }}">
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}


<script>
    function updatePath() {
        const breedSelect = document.getElementById("breedSelect");
        const pathField = document.getElementById("pathField");

        if (breedSelect.value) {
            pathField.value = "pd-fpy_138/Dogs/" + breedSelect.value;
        } else {
            pathField.value = "pd-fpy_138/Dogs";
        }
    }

    // Обновить путь при загрузке страницы, если порода уже выбрана
    updatePath();
</script>

</body>
</html>
